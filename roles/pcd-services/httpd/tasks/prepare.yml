---
##
# pcd-services/httpd prepare
#

- name: add {{ HTTPD_USER_GROUP }} group
  group: name={{ HTTPD_USER_GROUP }} system=yes
  

- { include: "{{ pcd_task_add_user }}", task: {
      name: "{{ HTTPD_USER }}",
      group: "{{ HTTPD_USER_GROUP }}", 
      home: "{{ HTTPD_USER_HOME }}",
      system: yes,
      github: yes,
      key: "{{ httpd_user_key }}"
    }
  }
  
- name: ensure log directory
  file: 
    path={{ HTTPD_LOG_DIR }}
    state=directory
    owner={{ HTTPD_USER }}
    mode=0777
    
- name: ensure default organization directory
  file: 
    path={{ PCD_SITES_DIR }}/{{ PCD_DEFAULT_SITE_ORG }}
    state=directory
    owner={{ HTTPD_USER }}
    group={{ HTTPD_USER_GROUP }}
    mode=0775
  
- name: ensure ssl certificate directory
  file: 
    path={{ HTTPD_SSL_DIR }}
    state=directory
    owner={{ HTTPD_USER }}
    group={{ HTTPD_USER_GROUP }}
    mode=0775
    